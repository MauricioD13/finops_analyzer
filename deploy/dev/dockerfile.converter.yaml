FROM python:3.11-slim

# Install Poetry
RUN pip install --no-cache-dir poetry

# Configure Poetry
ENV POETRY_VIRTUALENVS_CREATE=false

WORKDIR /app

# Create a minimal pyproject.toml with correct Python version constraint
RUN echo '[tool.poetry]\n\
name = "focus-converter-app"\n\
version = "0.1.0"\n\
description = ""\n\
authors = []\n\
\n\
[tool.poetry.dependencies]\n\
python = "^3.9"\n\
\n\
[build-system]\n\
requires = ["poetry-core"]\n\
build-backend = "poetry.core.masonry.api"' > pyproject.toml

# Install focus_converter first (it will install its required pandera version)
RUN poetry add focus_converter

# Add other dependencies (removed conflicting pandera version)
RUN poetry add "typer==0.9.0" "click==8.0.4" "multimethod<2"

# Create workspace directory
RUN mkdir -p /app/workspace

CMD ["tail", "-f", "/dev/null"]